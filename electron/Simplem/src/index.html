<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSP設定（セキュリティ対策の一部）。scriptやeval()やcss,画像の読み込みなどでエラーが出る場合はここを調整要。 -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <!-- main.js側で設定する場合は、コメントアウトが必要　-->
    <!-- document.getElementsByTagName("title")[0].text = "*sample.text - Simplem" のような形でファイル名を反映させる？ -->
    <!--<title>Simplem</title>-->

    <!-- short hand, igniter, skillet, overwhelm, catalyst, gale, Simple Glint, SimpleGlint, Glint -->

    <!-- Bootstrap core CSS
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    -->
    <meta name="theme-color" content="#707070">

    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">

</head>

<body>
    <!--開く、保存、名前を付けて保存ボタン
    <div>
        <button id="open" type="button">Open</button>
        <button id="save" type="button">Save</button>
        <button id="save_as" type="button">Save as</button>
        <button id="some-button" type="button">Search</button>
    </div>
    -->


    <!-- preview CSS -->
    <link rel="stylesheet" href="css/preview.css">

    <!-- easymde CSS and JS -->
    <link rel="stylesheet" href="css/easymde.css">
    <script src="easymde.js"></script>

    <textarea id="my-text-area"></textarea>

</body>

<script>
    let easyMDE = new EasyMDE({
        element: document.getElementById('my-text-area'),
        autoDownloadFontAwesome: false,
        minHeight: "1px",
        //autosave: {
        //    enabled: true,
        //    delay: 1000,
        //    uniqueId: 'mde-autosave'
        //},
        previewImagesInEditor: false,
        //lineNumbers: true,
        autofocus: true,
        forceSync: true,
        hideIcons: ["fullscreen", "heading", "italic"],
        //initialValue: "# Hello world!",
        //parsingConfig: { allowAtxHeaderWithoutSpace: true },
        renderingConfig: {
            singleLineBreaks: true,
            //codeSyntaxHighlighting: true,
        },
        //テーブル機能はオプションとして登録予定。
        showIcons: ['strikethrough', 'code', 'redo', 'table', 'undo', 'heading-1', 'heading-2', 'heading-3', 'horizontal-rule'],
        spellChecker: false,
        status: ["lines"],
        //toolbar: false,
        toolbarTip: true,
        tabSize: 4,
        sideBySideFullscreen: false,


    });

    //イベントハンドラーの使用
    //easyMDE.codemirror.on("change", function () {
    //
    //    let ele_f_h1 = document.getElementsByClassName("cm-formatting-header-1");
    //    for (let i = 0; i < ele_f_h1.length; i++) {
    //
    //        if (ele_f_h1[i].innerHTML == "# ") {
    //            ele_f_h1[i].setAttribute("style", "display:none;");
    //
    //        } else {
    //            //ele_f_h1[i].setAttribute("style", "display:inline;");
    //        };
    //    }
    //});

</script>


<!-- 以下、electronのレンダラー用script -->
<script>




    //ipc経由の機能------------------------------------------------------------------<
    //nodeIntegrationをfalseにしたことで、以下は使えなくなった
    //const {ipcRenderer, app} = require('electron');
    //
    //preload.jsで定義したことで、代わりに以下が使用可能
    let ipcRenderer = window.ipcRenderer;
    const app = window.app;


    //main.jsからのファイル読み込み命令を処理
    ipcRenderer.on('open_from_main.js', async () => {
        const { canceled, data } = await ipcRenderer.invoke('open') //main.jsのopenを呼び出し（data取得）
        if (canceled) return
        let file_text_data = '';
        file_text_data = data[0] || '';
        easyMDE.value(file_text_data);
    });

    //main.jsからの上書き保存命令を処理
    ipcRenderer.on('save_from_main.js', async () => {
        const text_data = easyMDE.value();
        await ipcRenderer.invoke('save', text_data); //main.jsのsaveを呼び出し(text_data受渡)
    });

    //main.jsからの名前を付けて保存命令を処理
    ipcRenderer.on('save_as_from_main.js', async () => {
        const text_data = easyMDE.value();
        await ipcRenderer.invoke('save_as', text_data);
    });

    //main.jsからの引数で渡されたファイル読み込み命令を処理
    ipcRenderer.on('open_init_from_main.js', async () => {
        const { data } = await ipcRenderer.invoke('open_init'); //main.jsのopen_initを呼び出し（data取得）
        let file_text_data = '';
        file_text_data = data || '';
        easyMDE.value(file_text_data);

    });

    //main.jsからのselectall命令を処理
    ipcRenderer.on('selectall_from_main.js', async () => {

        easyMDE.codemirror.execCommand('selectAll');

    });

    //let remote = window.remote;
    //let searchInPage = window.searchInPage;
    //main.jsからの検索窓オープンの命令を処理
    //ipcRenderer.on('webdata', async (webcontents_for_search) => {
    //    let inPageSearch = searchInPage(webcontents_for_search);
    //    inPageSearch.openSearchWindow();
    //});



    //ファイルの読み込みをmain.jsから呼び出し（ボタン用）
    //document.querySelector('#open').addEventListener('click', async () => {
    //    const { canceled, data } = await ipcRenderer.invoke('open')
    //    if (canceled) return
    //    let file_text_data = '';
    //    file_text_data = data[0] || '';
    //    easyMDE.value(file_text_data);
    //});

    //ファイルの上書き保存をmain.jsから呼び出し（ボタン用）
    //document.querySelector('#save').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save', text_data);
    //});


    //ファイルの名前を付けて保存をmain.jsから呼び出し（ボタン用）
    //document.querySelector('#save_as').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save_as', text_data);
    //});

    //ipc経由の機能------------------------------------------------------------------>


</script>

</html>