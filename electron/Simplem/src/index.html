<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSPË®≠ÂÆöÔºà„Çª„Ç≠„É•„É™„ÉÜ„Ç£ÂØæÁ≠ñ„ÅÆ‰∏ÄÈÉ®Ôºâ„ÄÇscript„ÇÑeval()„ÇÑcss,ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å™„Å©„Åß„Ç®„É©„Éº„ÅåÂá∫„ÇãÂ†¥Âêà„ÅØ„Åì„Åì„ÇíË™øÊï¥Ë¶Å„ÄÇ-->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <!-- mainÂÅ¥„ÅßË®≠ÂÆö„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„ÅåÂøÖË¶Å-->
    <!-- document.getElementsByTagName("title")[0].text = "*sample.text - Simplem" „ÅÆ„Çà„ÅÜ„Å™ÂΩ¢„Åß„Éï„Ç°„Ç§„É´Âêç„ÇíÂèçÊò†„Åï„Åõ„ÇãÔºü -->
    <!--<title>Simplem</title>-->
    <!-- short hand, igniter, skillet, overwhelm, catalyst, gale, Simple Glint, SimpleGlint, Glint -->

    <!-- Bootstrap core CSS
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    -->
    <meta name="theme-color" content="#707070">

    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">

    <!-- preview CSS -->
    <link rel="stylesheet" href="css/preview.css">

    <!-- easymde CSS and JS -->
    <link rel="stylesheet" href="css/easymde.css">
    <script src="easymde.js"></script>

    <!-- editor view mode CSS -->
    <link id="editor_view_mode_css" rel="stylesheet" href="css/editor_view_mode/evm_normal.css">

    <!-- print CSS -->
    <link rel="stylesheet" href="css/print.css">

    <!-- font CSS -->
    <link id="font_css" rel="stylesheet" href="css/font/font_modern_os.css">

    <!-- highlight.js -->
    <script id="hl_js" src="js/highlight/highlight.min.js"></script>
    <link id="code_hl_mode_css" rel="stylesheet" href="css/highlight_code/hljs_modern.min.css">
    <!--script>hljs.initHighlightingOnLoad();</script-->

    <!-- cm search addon css -->
    <link rel="stylesheet" href="cm_search_addon/dialog.css">
    <link rel="stylesheet" href="cm_search_addon/matchesonscrollbar.css">



</head>



<body>
    <!--Èñã„Åè„ÄÅ‰øùÂ≠ò„ÄÅÂêçÂâç„Çí‰ªò„Åë„Å¶‰øùÂ≠ò„Éú„Çø„É≥
    <div>
        <button id="open" type="button">Open</button>
        <button id="save" type="button">Save</button>
        <button id="save_as" type="button">Save as</button>
        <button id="some-button" type="button">Search</button>
    </div>
    -->
    <textarea id="my-text-area"></textarea>


    <!-- darkmode.js ÔºàÈÅ©Áî®„ÅÆ„Åü„ÇÅ„Å´css„ÅßËâ≤„ÄÖ‰øÆÊ≠£Ê∏à„ÅøÔºâ -->
    <script src="js/darkmode.min.js"></script>
    <script>
        function addDarkmodeWidget() {
            const options = {
                bottom: '4px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '5px', // default: 'unset'
                time: '0s', // default: '0.3s' css„Åßnone„Å´Ë®≠ÂÆö‰∏≠
                mixColor: '#fff', // default: '#fff'
                backgroundColor: '#fff',  // default: '#fff'
                buttonColorDark: '#fff',  // default: '#100f2c'
                buttonColorLight: '#100f2c', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'üåì', // default: ''
                autoMatchOsTheme: false // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        }
        window.addEventListener('load', addDarkmodeWidget);
    </script>
</body>

<script>
    let easyMDE = new EasyMDE({
        element: document.getElementById('my-text-area'),
        autoDownloadFontAwesome: false,
        minHeight: "1px",
        //autosave: {
        //    enabled: true,
        //    delay: 1000,
        //    uniqueId: 'mde-autosave'
        //},
        previewImagesInEditor: false,
        //lineNumbers: true,
        autofocus: true,
        forceSync: true,
        hideIcons: ["fullscreen", "heading", "italic", "image"],
        //initialValue: "# Hello world!",
        //parsingConfig: { allowAtxHeaderWithoutSpace: true },
        renderingConfig: {
            singleLineBreaks: true,
            codeSyntaxHighlighting: true,
        },
        //„ÉÜ„Éº„Éñ„É´Ê©üËÉΩ„ÅØ„Ç™„Éó„Ç∑„Éß„É≥„Å®„Åó„Å¶ÁôªÈå≤‰∫àÂÆö„ÄÇ'table',
        showIcons: ['strikethrough', 'code', 'redo', 'undo', 'heading-1', 'heading-2', 'heading-3', 'horizontal-rule'],
        spellChecker: false,
        status: ["lines"],
        //toolbar: false,
        toolbarTip: true,
        tabSize: 4,
        sideBySideFullscreen: false,
        syncSideBySidePreviewScroll: true,


    });

    //„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº„ÅÆ‰ΩøÁî®
    //easyMDE.codemirror.on("change", function () {
    //
    //    let ele_f_h1 = document.getElementsByClassName("cm-formatting-header-1");
    //    for (let i = 0; i < ele_f_h1.length; i++) {
    //
    //        if (ele_f_h1[i].innerHTML == "# ") {
    //            ele_f_h1[i].setAttribute("style", "display:none;");
    //
    //        } else {
    //            //ele_f_h1[i].setAttribute("style", "display:inline;");
    //        };
    //    }
    //});

</script>


<!-- ‰ª•‰∏ã„ÄÅelectron„ÅÆ„É¨„É≥„ÉÄ„É©„ÉºÁî®script -->
<script>




    //ipcÁµåÁî±„ÅÆÊ©üËÉΩ------------------------------------------------------------------<
    //nodeIntegration„Çífalse„Å´„Åó„Åü„Åì„Å®„Åß„ÄÅ‰ª•‰∏ã„ÅØ‰Ωø„Åà„Å™„Åè„Å™„Å£„Åü
    //const {ipcRenderer, app} = require('electron');
    //
    //preload.js„ÅßÂÆöÁæ©„Åó„Åü„Åì„Å®„Åß„ÄÅ‰ª£„Çè„Çä„Å´‰ª•‰∏ã„Åå‰ΩøÁî®ÂèØËÉΩ
    let ipcRenderer = window.ipcRenderer;
    const app = window.app;


    //main„Åã„Çâ„ÅÆ„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('open_from_main', async () => {
        const { canceled, data, fileDirPath } = await ipcRenderer.invoke('open') //main„ÅÆopen„ÇíÂëº„Å≥Âá∫„ÅóÔºàdataÂèñÂæóÔºâ
        if (canceled) return
        let file_text_data = '';
        file_text_data = data[0] || '';
        await easyMDE.value(file_text_data);

        //ÁîªÂÉèË°®Á§∫„Å™„Å©„ÅÆ„Éô„Éº„Çπurl„Å®„Åó„Å¶‰øùÂ≠ò
        window.fileDirPath = fileDirPath;

        //„Éï„Ç°„Ç§„É´Âêç„ÅÆÈ†≠„ÅÆ„Ç¢„Çπ„Çø„É™„Çπ„ÇØ„ÇíÂâäÈô§
        await ipcRenderer.invoke('open_asterisk_del');

        //„Éï„Ç°„Ç§„É´„ÅÆË™≠ËæºÊôÇ„ÅÆ*ËøΩÂä†„Çπ„ÇØ„É™„Éó„Éà„ÅÆËøΩÂä†
        await ipcRenderer.invoke('open_asterisk_script_add')

    });

    //main„Åã„Çâ„ÅÆ‰∏äÊõ∏„Åç‰øùÂ≠òÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('save_from_main', async () => {
        const text_data = easyMDE.value();
        await ipcRenderer.invoke('save', text_data); //main„ÅÆsave„ÇíÂëº„Å≥Âá∫„Åó(text_dataÂèóÊ∏°)
    });

    //main„Åã„Çâ„ÅÆÂêçÂâç„Çí‰ªò„Åë„Å¶‰øùÂ≠òÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('save_as_from_main', async () => {
        const text_data = easyMDE.value();

        const { fileDirPath } = await ipcRenderer.invoke('save_as', text_data);

        //ÁîªÂÉèË°®Á§∫„Å™„Å©„ÅÆ„Éô„Éº„Çπurl„Å®„Åó„Å¶‰øùÂ≠ò
        window.fileDirPath = fileDirPath;
    });

    //main„Åã„Çâ„ÅÆÂºïÊï∞„ÅßÊ∏°„Åï„Çå„Åü„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('open_init_from_main', async () => {
        const { data, fileDirPath } = await ipcRenderer.invoke('open_init'); //main„ÅÆopen_init„ÇíÂëº„Å≥Âá∫„ÅóÔºàdataÂèñÂæóÔºâ
        let file_text_data = '';
        file_text_data = data || '';
        await easyMDE.value(file_text_data);

        //ÁîªÂÉèË°®Á§∫„Å™„Å©„ÅÆ„Éô„Éº„Çπurl„Å®„Åó„Å¶‰øùÂ≠ò
        window.fileDirPath = fileDirPath;

        //„Éï„Ç°„Ç§„É´Âêç„ÅÆÈ†≠„ÅÆ„Ç¢„Çπ„Çø„É™„Çπ„ÇØ„ÇíÂâäÈô§
        await ipcRenderer.invoke('open_asterisk_del');

        //„Éï„Ç°„Ç§„É´„ÅÆË™≠ËæºÊôÇ„ÅÆ*ËøΩÂä†„Çπ„ÇØ„É™„Éó„Éà„ÅÆËøΩÂä†
        await ipcRenderer.invoke('open_asterisk_script_add')

    });

    //main„Åã„Çâ„ÅÆselectallÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('selectall_from_main', async () => {
        easyMDE.codemirror.execCommand('selectAll');

    });

    //main„Åã„Çâ„ÅÆfindÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('find_from_main', async () => {
        easyMDE.codemirror.execCommand('find');

    });

    //main„Åã„Çâ„ÅÆreplaceÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('replace_from_main', async () => {
        easyMDE.codemirror.execCommand('replace');

    });

    //main„Åã„Çâ„ÅÆclipboard„Å∏„ÅÆhtml„Ç≥„Éî„ÉºÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('html_to_clipboard_from_main', async () => {


        //„Éó„É¨„Éì„É•„Éºhtml„ÅÆÂèñÂæó
        //let preview_html_plaintext = easyMDE.options.previewRender(easyMDE.value()); //„Åß„ÇÇÂèØÔºàÂêåÁæ©Ôºâ
        //Á¨¨ÔºíÂºïÊï∞„Çífalse„Åßheader„ÅÆidÊ∑ªÂä†„Çí„Ç™„Éï
        let preview_html_plaintext = easyMDE.options.parent.markdown(easyMDE.value(), false);

        let domparser = new DOMParser();
        let preview_html_document = domparser.parseFromString(preview_html_plaintext, "text/html"); //DOMÊìç‰ΩúÂèØËÉΩ„Å™document„Ç™„Éñ„Ç∏„Çß„ÇíÂèñÂæó
        let parsered_preview_html_plaintext = preview_html_document.getElementsByTagName("body")[0].innerHTML;
        await ipcRenderer.invoke('html_to_clipboard', parsered_preview_html_plaintext);
    });

    //main„Åã„Çâ„ÅÆÂç∞Âà∑ÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('print_from_main', async () => {

        if (easyMDE.isPreviewActive() == false) {
            await easyMDE.togglePreview();
        }

        ipcRenderer.invoke('print');
    });

    //main„Åã„Çâ„ÅÆPDFÂá∫ÂäõÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('print_to_pdf_from_main', async () => {

        if (easyMDE.isPreviewActive() == false) {
            await easyMDE.togglePreview();
        }

        ipcRenderer.invoke('print_to_pdf');
    });

    //main„Åã„Çâ„ÅÆfontÂ§âÊõ¥ÂëΩ‰ª§„ÅÆÂá¶ÁêÜ
    ipcRenderer.on('change_font_from_main', async (event, font_kind) => {

        // idÂ±ûÊÄß„Åã„ÇâHTMLË¶ÅÁ¥†„ÇíÂèñÂæó
        let font_css_link = await document.getElementById("font_css");

        //font„É™„É≥„ÇØ„ÅÆhrefÊõ∏„ÅçÊèõ„Åà
        if (font_kind == "modern_os") {
            font_css_link.href = "css/font/font_modern_os.css";
        } else if (font_kind == "simplem") {
            font_css_link.href = "css/font/font_simplem.css";
        } else if (font_kind == "myricam") {
            font_css_link.href = "css/font/font_myricam.css";
        } else if (font_kind == "retro_rpg") {
            font_css_link.href = "css/font/font_retro_rpg.css";
        } else if (font_kind == "beautiful_pixel") {
            font_css_link.href = "css/font/font_pixel.css";
        } else if (font_kind == "beautiful_mincho") {
            font_css_link.href = "css/font/font_beautiful_mincho.css";
        } else if (font_kind == "ud_gothic") {
            font_css_link.href = "css/font/font_ud_gothic.css";
        } else if (font_kind == "ud_mincho") {
            font_css_link.href = "css/font/font_ud_mincho.css";
        } else if (font_kind == "modern_browser") {
            font_css_link.href = "css/font/font_modern_browser.css";
        }

        //„Ç´„Éº„ÇΩ„É´„ÅÆ„Çµ„Ç§„Ç∫„Çí„É™„Çª„ÉÉ„Éà
        await easyMDE.codemirror.execCommand('selectAll');
        //await document.activeElement.blur();
        //await easyMDE.codemirror.setCursor({ line: 0, ch: 0 });

    });

    //main„Åã„Çâ„ÅÆtoggle source code modeÂëΩ‰ª§„ÅÆÂá¶ÁêÜ
    ipcRenderer.on('toggle_source_code_mode_from_main', async (event, flg_source_code_mode) => {

        // idÂ±ûÊÄß„Åã„ÇâHTMLË¶ÅÁ¥†Ôºà„É™„É≥„ÇØË¶ÅÁ¥†Ôºâ„ÇíÂèñÂæó
        let editor_view_mode_css_link = await document.getElementById("editor_view_mode_css");

        //„É™„É≥„ÇØË¶ÅÁ¥†„ÅÆhrefÊõ∏„ÅçÊèõ„Åà
        if (flg_source_code_mode == "on_hl_on") {
            editor_view_mode_css_link.href = "css/editor_view_mode/evm_source_code_mode.css";
        } else if (flg_source_code_mode == "on_hl_off") {
            editor_view_mode_css_link.href = "css/editor_view_mode/evm_source_code_mode_hloff.css";
        } else {
            editor_view_mode_css_link.href = "css/editor_view_mode/evm_normal.css";
        }

        //„Ç´„Éº„ÇΩ„É´„ÅÆ„Çµ„Ç§„Ç∫„Çí„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„É¢„Éº„ÉâÁî®„Å´„É™„Çª„ÉÉ„Éà
        await easyMDE.codemirror.execCommand('selectAll');
        //easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        //document.activeElement.blur();
        //easyMDE.codemirror.execCommand("goDocStart");

    });

    //main„Åã„Çâ„ÅÆtoggle code hl modeÂëΩ‰ª§„ÅÆÂá¶ÁêÜ
    ipcRenderer.on('toggle_code_hl_mode_from_main', async (event, flg_code_hl_mode) => {

        // idÂ±ûÊÄß„Åã„ÇâHTMLË¶ÅÁ¥†Ôºà„É™„É≥„ÇØË¶ÅÁ¥†Ôºâ„ÇíÂèñÂæó
        let code_hl_mode_css_link = document.getElementById("code_hl_mode_css");

        //„É™„É≥„ÇØË¶ÅÁ¥†„ÅÆhrefÊõ∏„ÅçÊèõ„Åà
        if (flg_code_hl_mode == "on_code_hl_modern") {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_modern.min.css";
        } else if (flg_code_hl_mode == "on_code_hl_classic") {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_classic.min.css";
        } else {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_off.min.css";
        }

    });

    //main„Åã„Çâ„ÅÆ„Éû„Ç§„Éä„ÉºË®ÄË™û„Çµ„Éù„Éº„ÉàÂëΩ‰ª§„ÅÆÂá¶ÁêÜ
    ipcRenderer.on('toggle_minor_languages_support_from_main', async (event, flg_minor_languages_support) => {

        //„Çπ„ÇØ„É™„Éó„ÉàË¶ÅÁ¥†„ÅÆÁΩÆÊèõÔºàsrc„ÅÆÊõ∏„ÅçÊèõ„Åà„Åß„ÅØjs„ÅåÂÜçË™≠„ÅøËæº„Åø„Åï„Çå„Å™„ÅÑ„Åü„ÇÅ„ÄÅÁΩÆÊèõ„ÇíË°å„ÅÜÔºâ
        if (flg_minor_languages_support == true) {
            function load_hl_all_js() {
                let hl_js_script_tag = document.getElementById("hl_js");
                let temp_script_tag = document.createElement("script");
                temp_script_tag.id = "hl_js"
                temp_script_tag.src = "js/highlight/highlight_all.min.js";
                hl_js_script_tag.replaceWith(temp_script_tag);
            }
            load_hl_all_js();
        } else {
            function load_hl_js() {
                let hl_js_script_tag = document.getElementById("hl_js");
                let temp_script_tag = document.createElement("script");
                temp_script_tag.id = "hl_js"
                temp_script_tag.src = "js/highlight/highlight.min.js";
                hl_js_script_tag.replaceWith(temp_script_tag);
            }
            load_hl_js();
        }

    });



    //main„Åã„Çâ„ÅÆ„Éï„Ç°„Ç§„É´ÂêçÈ†≠„Ç¢„Çπ„Çø„É™„Çπ„ÇØËøΩÂä†Áî®„Çπ„ÇØ„É™„Éó„ÉàËøΩÂä†ÂëΩ‰ª§„ÅÆÂá¶ÁêÜ
    ipcRenderer.on('add_asterisk_script_from_main', async (event) => {

        //Ë¶ÅÁ¥†„ÅÆ‰ΩúÊàê
        let add_asterisk_script = await document.createElement('script');
        add_asterisk_script.id = "add_asterisk_js"


        //add_asterisk_script.textContent = "if (flg_ast_added == true) {easyMDE.codemirror.on('change', function () { ipcRenderer.invoke('add_asterisk_to_filename'); flg_ast_added = false; });};";
        add_asterisk_script.textContent = "easyMDE.codemirror.on('change', function testa() { ipcRenderer.invoke('add_asterisk_to_filename'); let remove_elem = document.getElementById('add_asterisk_js').remove();easyMDE.codemirror.off('change', testa); });";

        let html_tag = await document.getElementsByTagName("html");

        //ÊúÄÂæå„ÅÆÂ≠êË¶ÅÁ¥†„Å®„Åó„Å¶ËøΩÂä†
        await html_tag[0].appendChild(add_asterisk_script);

    });


    //main„Åã„Çâ„ÅÆ„Ç®„É©„ÉºË°®Á§∫ÂëΩ‰ª§„ÇíÂá¶ÁêÜ
    ipcRenderer.on('error_from_main', async (event, err) => {

        console.log('!!error in main.js!!: ' + err);
    });





    //„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Çímain„Åã„ÇâÂëº„Å≥Âá∫„ÅóÔºà„Éú„Çø„É≥Áî®Ôºâ
    //document.querySelector('#open').addEventListener('click', async () => {
    //    const { canceled, data } = await ipcRenderer.invoke('open')
    //    if (canceled) return
    //    let file_text_data = '';
    //    file_text_data = data[0] || '';
    //    easyMDE.value(file_text_data);
    //});

    //„Éï„Ç°„Ç§„É´„ÅÆ‰∏äÊõ∏„Åç‰øùÂ≠ò„Çímain„Åã„ÇâÂëº„Å≥Âá∫„ÅóÔºà„Éú„Çø„É≥Áî®Ôºâ
    //document.querySelector('#save').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save', text_data);
    //});


    //„Éï„Ç°„Ç§„É´„ÅÆÂêçÂâç„Çí‰ªò„Åë„Å¶‰øùÂ≠ò„Çímain„Åã„ÇâÂëº„Å≥Âá∫„ÅóÔºà„Éú„Çø„É≥Áî®Ôºâ
    //document.querySelector('#save_as').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save_as', text_data);
    //});


    //ipcÁµåÁî±„ÅÆÊ©üËÉΩ------------------------------------------------------------------>


    //„Éà„Éº„ÇØ„É≥Ë°®Á§∫„ÅÆ„ÉÜ„Çπ„Éà‰∏≠---------------------------------------------------------------------<
    //‰∏Ä„Å§„Åæ„Åà„ÅÆ„Ç´„Éº„ÇΩ„É´„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å†„Å£„ÅüÂ†¥ÊâÄ„Çí„Ç∞„É≠„Éº„Éê„É´‰øùÂ≠òÔºà„Ç∑„É£„Éº„ÉóË°®Á§∫„ÉÜ„Çπ„ÉàÁî®Ôºâ
    let arr_cur_pos = [{ init: null }];
    let arr_mark_state = [{ init: null }];
    let arr_native_cm_mark_state = [null];

    easyMDE.codemirror.on('cursorActivity', function () {

        //„Ç¢„É´„Ç¥„É™„Ç∫„É†
        //1 getstate.bold=true„Å™„Çâ„Åù„ÅÆË°å„Å´active„ÇØ„É©„ÇπÔºà#„ÇÑ**„ÇíË°®Á§∫ÔºâËøΩÂä†„ÄÇ
        //2 „Ç´„Éº„ÇΩ„É´ÁßªÂãï„Åî„Å®„Å´‰∏Ä„Å§Ââç„ÅÆ„Ç´„Éº„ÇΩ„É´„ÅÆË°å„ÅÆmark„Çí„ÇØ„É™„Ç¢„ÄÇÔºà‰∏Ä„Å§Ââç„ÅÆË°å„Åå‰ªä„ÅÆË°å„Å®Âêå„Åò„Å™„Çâ„Å∞„ÇØ„É™„Ç¢ÁÑ°„ÅóÔºâ

        //ÁèæÂú®„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±„Å®„Éû„Éº„ÇØÊÉÖÂ†±„ÇíÂèñÂæó
        let cur_pos = easyMDE.codemirror.getCursor();
        //console.log(cur_pos);//ÈñãÁô∫Áî® „Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆÊ§úÂá∫

        let mark_state = easyMDE.getState();
        //console.log(mark_state);//ÈñãÁô∫Áî® „Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÅÆ„Éû„Éº„ÇØÊ§úÂá∫



        //ÁèæÂú®„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÅÆË°å„ÅÆactive-line„Éû„Éº„ÇØ„ÅÆÊúâÁÑ°„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅ„ÄÅ„Éç„Ç§„ÉÜ„Ç£„Éñcm„Åã„Çâ„Éû„Éº„ÇØ„ÇíÂèñÂæó
        let native_cm_mark_state
        if (easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans) {
            native_cm_mark_state = easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans[0].marker.className;
        } else {
            native_cm_mark_state = null;
        }
        //console.log(native_cm_mark_state);


        //‰∏Ä„Å§„Åæ„Åà„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÅÆ„ÄÅ‰ΩçÁΩÆÊÉÖÂ†±„Å®„Éû„Éº„ÇØÊÉÖÂ†±„ÇíÂèñÂæóÔºàÁèæÂú®„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆÊÉÖÂ†±„ÇÇ‰øùÁÆ°„ÄÇÂÖàÂÖ•„ÇåÂæåÂá∫„ÅóÔºâ
        arr_cur_pos.unshift(cur_pos);
        let cur_pos_previous = arr_cur_pos.pop();

        arr_mark_state.unshift(mark_state);
        let mark_state_previous = arr_mark_state.pop();




        //„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„Åå„Éò„ÉÉ„ÉÄ„Éº„Å®„Éú„Éº„É´„Éâ„Å®ÂèñÊ∂à„ÅóÁ∑ö„ÅÆÊôÇ„Å´„ÄÅ„ÉÜ„Ç≠„Çπ„Éà„Éû„Éº„ÇØ(active-line„ÇØ„É©„Çπ)ËøΩÂä†„ÄÇ
        if ((mark_state.bold || mark_state.heading || mark_state.strikethrough || mark_state.code) && (native_cm_mark_state != "active-line")) {
            //easyMDE.codemirror.markText({ line: cur_pos.line, ch: 0 }, { line: cur_pos.line + 1, ch: 0 }, { className: "active-line", clearOnEnter: true });//„Éï„É©„Ç∞ÁÑ°„Åó„Åß„ÇÑ„Çã„Å™„Çâ„Åì„Å£„Å°
            easyMDE.codemirror.markText({ line: cur_pos.line, ch: 0 }, { line: cur_pos.line, ch: null }, { className: "active-line", inclusiveRight: true, inclusiveLeft: false });//ch„ÅÆ0 to null„ÄÄ„ÅßË°åÊåáÂÆö
        }


        //„Éû„Éº„ÇØËøΩÂä†Âæå„ÅÆ ÁèæÂú®„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÅÆË°å„ÅÆactive-line„Éû„Éº„ÇØ„ÅÆÊúâÁÑ°„ÅÆÊõ¥Êñ∞Á¢∫Ë™çÔºà„Éç„Ç§„ÉÜ„Ç£„Éñcm„Åã„Çâ„Éû„Éº„ÇØ„ÇíÂèñÂæóÔºâ
        if (easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans) {
            native_cm_mark_state = easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans[0].marker.className;
        } else {
            native_cm_mark_state = null;
        }


        arr_native_cm_mark_state.unshift(native_cm_mark_state);
        let native_cm_mark_state_previous = arr_native_cm_mark_state.pop();
        //console.log(native_cm_mark_state);


        //„Éû„Éº„ÇØ„ÅÆ„ÇØ„É™„Ç¢ÔºàÁõ¥Ââç„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„Åå„Éû„Éº„ÇØ„ÅÆÂ†¥Âêà„Å´ÂÆüË°åÔºâ
        if (mark_state_previous.heading || mark_state_previous.bold || mark_state_previous.strikethrough || mark_state_previous.code) {

            //„Éò„ÉÉ„ÉÄ„Éº„Å®„Éú„Éº„É´„Éâ„Å®ÂèñÊ∂à„ÅóÁ∑ö„ÅÆ„Éû„Éº„ÇØ„ÅÆ„ÇØ„É™„Ç¢ÔºàÁèæÂú®„ÅÆ„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„Åå„Éû„Éº„ÇØÁÑ°„Åó„ÅÆÂ†¥Âêà„Å´ÂÆüË°åÔºâ
            if ((((!mark_state.heading) && (!mark_state.bold) && (!mark_state.strikethrough) && (!mark_state.code)) || (cur_pos.line != cur_pos_previous.line)) && (native_cm_mark_state_previous == "active-line")) {
                try {
                    easyMDE.codemirror.findMarksAt({ line: cur_pos_previous.line, ch: cur_pos_previous.ch })[0].clear();
                } catch (er) {
                    //ÊÉ≥ÂÆöÂ§ñ„ÅÆ„Ç®„É©„ÉºÊôÇ„Å´‰∏ÄÊó¶„Éû„Éº„ÇØÁä∂ÊÖã„ÇíÂÖ®„Å¶„É™„Çª„ÉÉ„Éà„Åó„Å¶Á∑®ÈõÜ„ÇíÁ∂ôÁ∂ö„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã
                    console.log(er.message);
                    let all_marks = easyMDE.codemirror.getAllMarks();
                    for (let i = 0; i < all_marks.length; i++) {
                        all_marks[i].clear();
                    }

                }
            }

            //„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Éû„Éº„ÇØ„ÅÆ„ÇØ„É™„Ç¢
            //if (((!mark_state.heading) || (cur_pos.line != cur_pos_previous.line)) && (flg_active_line == true)) {
            //    easyMDE.codemirror.findMarksAt({ line: cur_pos_previous.line, ch: cur_pos_previous.ch })[0].clear();
            //    flg_active_line = !flg_active_line;
            //}
        }



        //„ÉÜ„Ç≠„Çπ„Éà„Éû„Éº„ÇØËøΩÂä†
        //easyMDE.codemirror.markText({ line: 0, ch: 0 }, { line: 1, ch: 0 }, { className: "hhhhasdf" });

        //„ÉÜ„Ç≠„Çπ„Éà„Éû„Éº„ÇØ„ÇØ„É™„Ç¢
        //easyMDE.codemirror.findMarksAt({ line: easyMDE.codemirror.getCursor().line, ch: easyMDE.codemirror.getCursor().line })[0].clear();


    });
    //„Éà„Éº„ÇØ„É≥Ë°®Á§∫„ÅÆ„ÉÜ„Çπ„Éà‰∏≠--------------------------------------------------------------------->




</script>

</html>