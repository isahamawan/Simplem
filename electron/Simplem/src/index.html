<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSPè¨­å®šï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ä¸€éƒ¨ï¼‰ã€‚scriptã‚„eval()ã‚„css,ç”»åƒã®èª­ã¿è¾¼ã¿ãªã©ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯ã“ã“ã‚’èª¿æ•´è¦ã€‚-->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <!-- mainå´ã§è¨­å®šã™ã‚‹å ´åˆã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆãŒå¿…è¦-->
    <!-- document.getElementsByTagName("title")[0].text = "*sample.text - Simplem" ã®ã‚ˆã†ãªå½¢ã§ãƒ•ã‚¡ã‚¤ãƒ«åã‚’åæ˜ ã•ã›ã‚‹ï¼Ÿ -->
    <!--<title>Simplem</title>-->
    <!-- short hand, igniter, skillet, overwhelm, catalyst, gale, Simple Glint, SimpleGlint, Glint -->

    <!-- Bootstrap core CSS
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    -->
    <meta name="theme-color" content="#707070">

    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">

    <!-- preview CSS -->
    <link rel="stylesheet" href="css/preview.css">

    <!-- easymde CSS and JS -->
    <link rel="stylesheet" href="css/easymde.css">
    <script src="easymde.js"></script>

    <!-- editor view mode CSS -->
    <link id="editor_view_mode_css" rel="stylesheet" href="css/editor_view_mode/evm_normal.css">

    <!-- print CSS -->
    <link id="print_css" rel="stylesheet" href="css/print.css">

    <!-- font CSS -->
    <link id="font_css" rel="stylesheet" href="css/font/font_modern_os.css">

    <!-- highlight.js -->
    <script id="hl_js" src="js/highlight/highlight.min.js"></script>
    <link id="code_hl_mode_css" rel="stylesheet" href="css/highlight_code/hljs_modern.min.css">
    <!--script>hljs.initHighlightingOnLoad();</script-->

    <!-- cm search addon css -->
    <link rel="stylesheet" href="cm_search_addon/dialog.css">
    <link rel="stylesheet" href="cm_search_addon/matchesonscrollbar.css">

    <!-- cm merge addon css depend js -->
    <link rel="stylesheet" href="css/merge.css">
    <script src="js/diff_match_patch.js"></script>

    <!-- option css -->
    <link rel="stylesheet" href="css/option/same_font_size.css">
    <link rel="stylesheet" href="css/option/line_height_wide.css">
</head>



<body>
    <div id="toc_wrapper" style="display:none;">
        <div class="toc_title">ç›®æ¬¡</div>
        <div id="toc">
        </div>
    </div>
    <!--é–‹ãã€ä¿å­˜ã€åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ãƒœã‚¿ãƒ³
    <div>
        <button id="open" type="button">Open</button>
        <button id="save" type="button">Save</button>
        <button id="save_as" type="button">Save as</button>
        <button id="some-button" type="button">Search</button>
    </div>
    -->
    <textarea id="my-text-area"></textarea>



</body>

<script>
    let easyMDE = new EasyMDE({
        element: document.getElementById('my-text-area'),
        autoDownloadFontAwesome: false,
        minHeight: "1px",
        //autosave: {
        //    enabled: true,
        //    delay: 1000,
        //    uniqueId: 'mde-autosave'
        //},
        //styleActiveLine: true,//easymde.jsä¿®æ­£è¦
        previewImagesInEditor: false,
        //lineNumbers: true,
        autofocus: false,
        forceSync: false,
        hideIcons: ["fullscreen", "heading", "italic", "image"],
        //initialValue: "# Hello world!",
        //parsingConfig: { allowAtxHeaderWithoutSpace: true },
        renderingConfig: {
            singleLineBreaks: true,
            codeSyntaxHighlighting: true,
        },
        //ãƒ†ãƒ¼ãƒ–ãƒ«æ©Ÿèƒ½ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ç™»éŒ²äºˆå®šã€‚'table',
        showIcons: ['strikethrough', 'code', 'redo', 'undo', 'heading-1', 'heading-2', 'heading-3', 'horizontal-rule', 'memo'],
        spellChecker: false,
        status: ["lines"],
        //toolbar: false,
        toolbarTip: true,
        tabSize: 4,
        sideBySideFullscreen: false,
        syncSideBySidePreviewScroll: true,


    });

    //ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ä½¿ç”¨
    //easyMDE.codemirror.on("change", function () {
    //
    //    let ele_f_h1 = document.getElementsByClassName("cm-formatting-header-1");
    //    for (let i = 0; i < ele_f_h1.length; i++) {
    //
    //        if (ele_f_h1[i].innerHTML == "# ") {
    //            ele_f_h1[i].setAttribute("style", "display:none;");
    //
    //        } else {
    //            //ele_f_h1[i].setAttribute("style", "display:inline;");
    //        };
    //    }
    //});

</script>

<!-- toc js -->
<script src="js/toc.js"></script>
<link rel="stylesheet" href="css/toc.css">
<!-- toc_for_preview js -->
<script src="js/toc_for_preview.js"></script>
<!-- toc_for_marp js -->
<script src="js/toc_for_marp.js"></script>

<!-- ä»¥ä¸‹ã€electronã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ç”¨script -->
<script>




    //ipcçµŒç”±ã®æ©Ÿèƒ½------------------------------------------------------------------<
    //nodeIntegrationã‚’falseã«ã—ãŸã“ã¨ã§ã€ä»¥ä¸‹ã¯ä½¿ãˆãªããªã£ãŸ
    //const {ipcRenderer, app} = require('electron');
    //
    //preload.jsã§å®šç¾©ã—ãŸã“ã¨ã§ã€ä»£ã‚ã‚Šã«ä»¥ä¸‹ãŒä½¿ç”¨å¯èƒ½
    let ipcRenderer = window.ipcRenderer;
    const app = window.app;


    //mainã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('open_from_main', async () => {
        const { canceled, data, fileDirPath } = await ipcRenderer.invoke('open') //mainã®openã‚’å‘¼ã³å‡ºã—ï¼ˆdataå–å¾—ï¼‰
        if (canceled) return
        let file_text_data = '';
        file_text_data = data[0] || '';

        if (easyMDE.isPreviewActive() == true) {
            await easyMDE.togglePreview();
        }

        await easyMDE.value(file_text_data);

        //diffã®ã‚ªãƒªã‚¸ãƒŠãƒ«ç”¨ã¨ã—ã¦ä¿å­˜
        window.diff_origin_text_data = file_text_data;

        //ç”»åƒè¡¨ç¤ºãªã©ã®ãƒ™ãƒ¼ã‚¹urlã¨ã—ã¦ä¿å­˜
        window.fileDirPath = fileDirPath;

        //ãƒ•ã‚¡ã‚¤ãƒ«åã®é ­ã®ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’å‰Šé™¤
        await ipcRenderer.invoke('open_asterisk_del');

        //ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­è¾¼æ™‚ã®*è¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¿½åŠ 
        await ipcRenderer.invoke('open_asterisk_script_add')

    });

    //mainã‹ã‚‰ã®ä¸Šæ›¸ãä¿å­˜å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('save_from_main', async () => {
        const text_data = easyMDE.value();
        await ipcRenderer.invoke('save', text_data); //mainã®saveã‚’å‘¼ã³å‡ºã—(text_dataå—æ¸¡)

        //diffã®ã‚ªãƒªã‚¸ãƒŠãƒ«ç”¨ã¨ã—ã¦ä¿å­˜
        window.diff_origin_text_data = text_data;
    });

    //mainã‹ã‚‰ã®åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('save_as_from_main', async () => {
        const text_data = easyMDE.value();

        const { fileDirPath } = await ipcRenderer.invoke('save_as', text_data);

        //diffã®ã‚ªãƒªã‚¸ãƒŠãƒ«ç”¨ã¨ã—ã¦ä¿å­˜
        window.diff_origin_text_data = text_data;

        //ç”»åƒè¡¨ç¤ºãªã©ã®ãƒ™ãƒ¼ã‚¹urlã¨ã—ã¦ä¿å­˜
        window.fileDirPath = fileDirPath;
    });

    //mainã‹ã‚‰ã®å¼•æ•°ã§æ¸¡ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('open_init_from_main', async () => {
        const { data, fileDirPath } = await ipcRenderer.invoke('open_init'); //mainã®open_initã‚’å‘¼ã³å‡ºã—ï¼ˆdataå–å¾—ï¼‰
        let file_text_data = '';
        file_text_data = data || '';
        await easyMDE.value(file_text_data);

        //diffã®ã‚ªãƒªã‚¸ãƒŠãƒ«ç”¨ã¨ã—ã¦ä¿å­˜
        window.diff_origin_text_data = file_text_data;

        //ç”»åƒè¡¨ç¤ºãªã©ã®ãƒ™ãƒ¼ã‚¹urlã¨ã—ã¦ä¿å­˜
        window.fileDirPath = fileDirPath;

        //ãƒ•ã‚¡ã‚¤ãƒ«åã®é ­ã®ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’å‰Šé™¤
        await ipcRenderer.invoke('open_asterisk_del');

        //ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­è¾¼æ™‚ã®*è¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¿½åŠ 
        await ipcRenderer.invoke('open_asterisk_script_add')

    });

    //mainã‹ã‚‰ã®selectallå‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('selectall_from_main', async () => {
        easyMDE.codemirror.execCommand('selectAll');

    });

    //mainã‹ã‚‰ã®findå‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('find_from_main', async () => {
        easyMDE.codemirror.execCommand('find');

    });

    //mainã‹ã‚‰ã®replaceå‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('replace_from_main', async () => {
        easyMDE.codemirror.execCommand('replace');

    });

    //mainã‹ã‚‰ã®clipboardã¸ã®htmlã‚³ãƒ”ãƒ¼å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('html_to_clipboard_from_main', async () => {


        //ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼htmlã®å–å¾—
        //let preview_html_plaintext = easyMDE.options.previewRender(easyMDE.value()); //ã§ã‚‚å¯ï¼ˆåŒç¾©ï¼‰
        //ç¬¬ï¼’å¼•æ•°ã‚’falseã§headerã®idæ·»åŠ ã‚’ã‚ªãƒ•
        let preview_html_plaintext = easyMDE.options.parent.markdown(easyMDE.value(), false);

        let domparser = new DOMParser();
        let preview_html_document = domparser.parseFromString(preview_html_plaintext, "text/html"); //DOMæ“ä½œå¯èƒ½ãªdocumentã‚ªãƒ–ã‚¸ã‚§ã‚’å–å¾—
        let parsered_preview_html_plaintext = preview_html_document.getElementsByTagName("body")[0].innerHTML;
        await ipcRenderer.invoke('html_to_clipboard', parsered_preview_html_plaintext);
    });

    //mainã‹ã‚‰ã®å°åˆ·å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('print_from_main', async () => {

        if (easyMDE.isPreviewActive() == false) {
            await easyMDE.togglePreview();

            //10mså¾…æ©Ÿ
            const _sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
            await _sleep(10);
        }

        ipcRenderer.invoke('print');

    });

    //mainã‹ã‚‰ã®PDFå‡ºåŠ›å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('print_to_pdf_from_main', async () => {

        if (easyMDE.isPreviewActive() == false) {
            await easyMDE.togglePreview();

            //10mså¾…æ©Ÿ
            const _sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
            await _sleep(10);
        }

        ipcRenderer.invoke('print_to_pdf');

    });

    //mainã‹ã‚‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼åˆ‡æ›¿å‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('preview_off_from_main', async () => {
        //ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿
        if (easyMDE.isPreviewActive() == true) {
            await easyMDE.togglePreview();

            //10mså¾…æ©Ÿ
            //const _sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
            //_sleep(10);
        }

    });


    //mainã‹ã‚‰ã®fontå¤‰æ›´å‘½ä»¤ã®å‡¦ç†
    ipcRenderer.on('change_font_from_main', async (event, font_kind) => {

        // idå±æ€§ã‹ã‚‰HTMLè¦ç´ ã‚’å–å¾—
        let font_css_link = await document.getElementById("font_css");

        //fontãƒªãƒ³ã‚¯ã®hrefæ›¸ãæ›ãˆ
        if (font_kind == "modern_os") {
            font_css_link.href = "css/font/font_modern_os.css";
        } else if (font_kind == "simplem") {
            font_css_link.href = "css/font/font_simplem.css";
        } else if (font_kind == "myricam") {
            font_css_link.href = "css/font/font_myricam.css";
        } else if (font_kind == "retro_rpg") {
            font_css_link.href = "css/font/font_retro_rpg.css";
        } else if (font_kind == "beautiful_pixel") {
            font_css_link.href = "css/font/font_pixel.css";
        } else if (font_kind == "beautiful_mincho") {
            font_css_link.href = "css/font/font_beautiful_mincho.css";
        } else if (font_kind == "ud_gothic") {
            font_css_link.href = "css/font/font_ud_gothic.css";
        } else if (font_kind == "ud_mincho") {
            font_css_link.href = "css/font/font_ud_mincho.css";
        } else if (font_kind == "modern_browser") {
            font_css_link.href = "css/font/font_modern_browser.css";
        }

        //ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆ
        await easyMDE.codemirror.execCommand('selectAll');
        await setTimeout(function () {
            easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        }, 10);

        //await document.activeElement.blur();
        //await easyMDE.codemirror.setCursor({ line: 0, ch: 0 });

    });

    //mainã‹ã‚‰ã®toggle source code modeå‘½ä»¤ã®å‡¦ç†
    ipcRenderer.on('toggle_source_code_mode_from_main', async (event, flg_source_code_mode) => {

        //æ–‡å­—ã‚µã‚¤ã‚ºçµ±ä¸€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è§£é™¤
        if (window.flg_same_font_size == true) {
            document.getElementsByClassName("EasyMDEContainer")[0].classList.remove("same_font_size");
        }


        // idå±æ€§ã‹ã‚‰HTMLè¦ç´ ï¼ˆãƒªãƒ³ã‚¯è¦ç´ ï¼‰ã‚’å–å¾—
        let editor_view_mode_css_link = await document.getElementById("editor_view_mode_css");

        //ãƒªãƒ³ã‚¯è¦ç´ ã®hrefæ›¸ãæ›ãˆ
        if (flg_source_code_mode == "on_hl_on") {
            editor_view_mode_css_link.href = "css/editor_view_mode/evm_source_code_mode.css";
        } else if (flg_source_code_mode == "on_hl_off") {
            editor_view_mode_css_link.href = "css/editor_view_mode/evm_source_code_mode_hloff.css";
        } else if (flg_source_code_mode == "mark_view") {

            //æ–‡å­—ã‚µã‚¤ã‚ºçµ±ä¸€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®š
            if (window.flg_same_font_size == true) {
                document.getElementsByClassName("EasyMDEContainer")[0].classList.add("same_font_size");
            }

            editor_view_mode_css_link.href = "css/editor_view_mode/evm_mark_view.css";
        } else {

            //æ–‡å­—ã‚µã‚¤ã‚ºçµ±ä¸€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®š
            if (window.flg_same_font_size == true) {
                document.getElementsByClassName("EasyMDEContainer")[0].classList.add("same_font_size");
            }

            editor_view_mode_css_link.href = "css/editor_view_mode/evm_normal.css";
        }

        //ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ç”¨ã«ãƒªã‚»ãƒƒãƒˆ
        //await easyMDE.codemirror.execCommand('selectAll');
        //await setTimeout(function () {
        //    easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        //}, 10);

        //easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        //document.activeElement.blur();
        //easyMDE.codemirror.execCommand("goDocStart");

    });

    //mainã‹ã‚‰ã®toggle code hl modeå‘½ä»¤ã®å‡¦ç†
    ipcRenderer.on('toggle_code_hl_mode_from_main', async (event, flg_code_hl_mode) => {

        //æ–‡å­—ã‚µã‚¤ã‚ºçµ±ä¸€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è§£é™¤
        if (window.flg_same_font_size == true) {
            document.getElementsByClassName("EasyMDEContainer")[0].classList.remove("page_break_hr");
        }

        // idå±æ€§ã‹ã‚‰HTMLè¦ç´ ï¼ˆãƒªãƒ³ã‚¯è¦ç´ ï¼‰ã‚’å–å¾—
        let code_hl_mode_css_link = document.getElementById("code_hl_mode_css");

        //ãƒªãƒ³ã‚¯è¦ç´ ã®hrefæ›¸ãæ›ãˆ
        if (flg_code_hl_mode == "on_code_hl_modern") {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_modern.min.css";
        } else if (flg_code_hl_mode == "on_code_hl_classic") {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_classic.min.css";
        } else {
            code_hl_mode_css_link.href = "css/highlight_code/hljs_off.min.css";
        }

    });

    //mainã‹ã‚‰ã®ãƒã‚¤ãƒŠãƒ¼è¨€èªã‚µãƒãƒ¼ãƒˆå‘½ä»¤ã®å‡¦ç†
    ipcRenderer.on('toggle_minor_languages_support_from_main', async (event, flg_minor_languages_support) => {

        //ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¦ç´ ã®ç½®æ›ï¼ˆsrcã®æ›¸ãæ›ãˆã§ã¯jsãŒå†èª­ã¿è¾¼ã¿ã•ã‚Œãªã„ãŸã‚ã€ç½®æ›ã‚’è¡Œã†ï¼‰
        if (flg_minor_languages_support == true) {
            function load_hl_all_js() {
                let hl_js_script_tag = document.getElementById("hl_js");
                let temp_script_tag = document.createElement("script");
                temp_script_tag.id = "hl_js"
                temp_script_tag.src = "js/highlight/highlight_all.min.js";
                hl_js_script_tag.replaceWith(temp_script_tag);
            }
            load_hl_all_js();
        } else {
            function load_hl_js() {
                let hl_js_script_tag = document.getElementById("hl_js");
                let temp_script_tag = document.createElement("script");
                temp_script_tag.id = "hl_js"
                temp_script_tag.src = "js/highlight/highlight.min.js";
                hl_js_script_tag.replaceWith(temp_script_tag);
            }
            load_hl_js();
        }

    });



    //mainã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«åé ­ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯è¿½åŠ ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ å‘½ä»¤ã®å‡¦ç†
    ipcRenderer.on('add_asterisk_script_from_main', async (event) => {

        //è¦ç´ ã®ä½œæˆ
        let add_asterisk_script = await document.createElement('script');
        add_asterisk_script.id = "add_asterisk_js"


        //add_asterisk_script.textContent = "if (flg_ast_added == true) {easyMDE.codemirror.on('change', function () { ipcRenderer.invoke('add_asterisk_to_filename'); flg_ast_added = false; });};";
        add_asterisk_script.textContent = "easyMDE.codemirror.on('change', function testa() { ipcRenderer.invoke('add_asterisk_to_filename'); let remove_elem = document.getElementById('add_asterisk_js').remove();easyMDE.codemirror.off('change', testa); });";

        let html_tag = await document.getElementsByTagName("html");

        //æœ€å¾Œã®å­è¦ç´ ã¨ã—ã¦è¿½åŠ 
        await html_tag[0].appendChild(add_asterisk_script);

    });


    //mainã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('error_from_main', async (event, err) => {

        console.log('!!error in main.js!!: ' + err);
    });


    //mainã‹ã‚‰ã®toggle_flg_slideshow_fullscreenå‘½ä»¤ã‚’å‡¦ç†
    ipcRenderer.on('toggle_flg_slideshow_fullscreen_from_main', async (event) => {

        flg_slideshow_fullscreen = !flg_slideshow_fullscreen

    });

    //mainã‹ã‚‰ã®toggle_no_page_break_h1_in_noteå‘½ä»¤ã‚’å‡¦ç†
    window.flg_no_page_break_h1_in_note = false;
    ipcRenderer.on('toggle_no_page_break_h1_in_note', async (event) => {

        flg_no_page_break_h1_in_note = !flg_no_page_break_h1_in_note

        if (flg_no_page_break_h1_in_note == true) {
            document.getElementsByClassName("CodeMirror-wrap")[0].classList.add("no_page_break_h1");
        } else {
            document.getElementsByClassName("CodeMirror-wrap")[0].classList.remove("no_page_break_h1");
        }

    });

    //mainã‹ã‚‰ã®toggle_page_break_hr_in_noteå‘½ä»¤ã‚’å‡¦ç†
    window.flg_page_break_hr_in_note = false;
    ipcRenderer.on('toggle_page_break_hr_in_note', async (event) => {

        flg_page_break_hr_in_note = !flg_page_break_hr_in_note

        if (flg_page_break_hr_in_note == true) {
            document.getElementsByClassName("EasyMDEContainer")[0].classList.add("page_break_hr");
        } else {
            document.getElementsByClassName("EasyMDEContainer")[0].classList.remove("page_break_hr");
        }

    });

    //mainã‹ã‚‰ã®toggle_line_height_wide_from_mainå‘½ä»¤ã‚’å‡¦ç†
    window.flg_line_height_wide = false;
    ipcRenderer.on('toggle_line_height_wide_from_main', async (event) => {

        flg_line_height_wide = !flg_line_height_wide

        if (flg_line_height_wide == true) {
            await document.getElementsByClassName("EasyMDEContainer")[0].classList.add("line_height_wide");
        } else {
            await document.getElementsByClassName("EasyMDEContainer")[0].classList.remove("line_height_wide");
        }


        //ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆ
        await easyMDE.codemirror.execCommand('selectAll');
        await setTimeout(function () {
            easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        }, 10);

    });

    //mainã‹ã‚‰ã®toggle_same_font_size_from_mainå‘½ä»¤ã‚’å‡¦ç†
    window.flg_same_font_size = true;
    document.getElementsByClassName("EasyMDEContainer")[0].classList.add("same_font_size");

    ipcRenderer.on('toggle_same_font_size_from_main', async (event) => {

        flg_same_font_size = !flg_same_font_size

        if (flg_same_font_size == true) {
            await document.getElementsByClassName("EasyMDEContainer")[0].classList.add("same_font_size");
        } else {
            await document.getElementsByClassName("EasyMDEContainer")[0].classList.remove("same_font_size");
        }


        //ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆ
        await easyMDE.codemirror.execCommand('selectAll');
        await setTimeout(function () {
            easyMDE.codemirror.setCursor({ line: 0, ch: 0 });
        }, 10);

    });

    //ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’mainã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆãƒœã‚¿ãƒ³ç”¨ï¼‰
    //document.querySelector('#open').addEventListener('click', async () => {
    //    const { canceled, data } = await ipcRenderer.invoke('open')
    //    if (canceled) return
    //    let file_text_data = '';
    //    file_text_data = data[0] || '';
    //    easyMDE.value(file_text_data);
    //});

    //ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸Šæ›¸ãä¿å­˜ã‚’mainã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆãƒœã‚¿ãƒ³ç”¨ï¼‰
    //document.querySelector('#save').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save', text_data);
    //});


    //ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã‚’mainã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆãƒœã‚¿ãƒ³ç”¨ï¼‰
    //document.querySelector('#save_as').addEventListener('click', async () => {
    //    const text_data = easyMDE.value();
    //    await ipcRenderer.invoke('save_as', text_data);
    //});


    //ipcçµŒç”±ã®æ©Ÿèƒ½------------------------------------------------------------------>


    //ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆä¸­---------------------------------------------------------------------<
    //ä¸€ã¤ã¾ãˆã®ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸå ´æ‰€ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¿å­˜ï¼ˆã‚·ãƒ£ãƒ¼ãƒ—è¡¨ç¤ºãƒ†ã‚¹ãƒˆç”¨ï¼‰
    let arr_cur_pos = [{ init: null }];
    let arr_mark_state = [{ init: null }];
    let arr_native_cm_mark_state = [null];

    easyMDE.codemirror.on('cursorActivity', function () {

        //ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
        //1 getstate.bold=trueãªã‚‰ãã®è¡Œã«activeã‚¯ãƒ©ã‚¹ï¼ˆ#ã‚„**ã‚’è¡¨ç¤ºï¼‰è¿½åŠ ã€‚
        //2 ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã”ã¨ã«ä¸€ã¤å‰ã®ã‚«ãƒ¼ã‚½ãƒ«ã®è¡Œã®markã‚’ã‚¯ãƒªã‚¢ã€‚ï¼ˆä¸€ã¤å‰ã®è¡ŒãŒä»Šã®è¡Œã¨åŒã˜ãªã‚‰ã°ã‚¯ãƒªã‚¢ç„¡ã—ï¼‰

        //ç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®ä½ç½®æƒ…å ±ã¨ãƒãƒ¼ã‚¯æƒ…å ±ã‚’å–å¾—
        let cur_pos = easyMDE.codemirror.getCursor();
        //console.log(cur_pos);//é–‹ç™ºç”¨ ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®æ¤œå‡º

        let mark_state = easyMDE.getState();
        //console.log(mark_state);//é–‹ç™ºç”¨ ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®ãƒãƒ¼ã‚¯æ¤œå‡º



        //ç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®è¡Œã®active-lineãƒãƒ¼ã‚¯ã®æœ‰ç„¡ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ãƒã‚¤ãƒ†ã‚£ãƒ–cmã‹ã‚‰ãƒãƒ¼ã‚¯ã‚’å–å¾—
        let native_cm_mark_state
        if (easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans) {
            native_cm_mark_state = easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans[0].marker.className;
        } else {
            native_cm_mark_state = null;
        }
        //console.log(native_cm_mark_state);


        //ä¸€ã¤ã¾ãˆã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®ã€ä½ç½®æƒ…å ±ã¨ãƒãƒ¼ã‚¯æƒ…å ±ã‚’å–å¾—ï¼ˆç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®æƒ…å ±ã‚‚ä¿ç®¡ã€‚å…ˆå…¥ã‚Œå¾Œå‡ºã—ï¼‰
        arr_cur_pos.unshift(cur_pos);
        let cur_pos_previous = arr_cur_pos.pop();

        arr_mark_state.unshift(mark_state);
        let mark_state_previous = arr_mark_state.pop();




        //ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒœãƒ¼ãƒ«ãƒ‰ã¨å–æ¶ˆã—ç·šã®æ™‚ã«ã€ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ã‚¯(active-lineã‚¯ãƒ©ã‚¹)è¿½åŠ ã€‚
        if ((mark_state.bold || mark_state.heading || mark_state.strikethrough || mark_state.code) && (native_cm_mark_state != "active-line")) {
            //easyMDE.codemirror.markText({ line: cur_pos.line, ch: 0 }, { line: cur_pos.line + 1, ch: 0 }, { className: "active-line", clearOnEnter: true });//ãƒ•ãƒ©ã‚°ç„¡ã—ã§ã‚„ã‚‹ãªã‚‰ã“ã£ã¡
            easyMDE.codemirror.markText({ line: cur_pos.line, ch: 0 }, { line: cur_pos.line, ch: null }, { className: "active-line", inclusiveRight: true, inclusiveLeft: false });//chã®0 to nullã€€ã§è¡ŒæŒ‡å®š
        }


        //ãƒãƒ¼ã‚¯è¿½åŠ å¾Œã® ç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®è¡Œã®active-lineãƒãƒ¼ã‚¯ã®æœ‰ç„¡ã®æ›´æ–°ç¢ºèªï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–cmã‹ã‚‰ãƒãƒ¼ã‚¯ã‚’å–å¾—ï¼‰
        if (easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans) {
            native_cm_mark_state = easyMDE.codemirror.getLineHandle(cur_pos.line).markedSpans[0].marker.className;
        } else {
            native_cm_mark_state = null;
        }


        arr_native_cm_mark_state.unshift(native_cm_mark_state);
        let native_cm_mark_state_previous = arr_native_cm_mark_state.pop();
        //console.log(native_cm_mark_state);


        //ãƒãƒ¼ã‚¯ã®ã‚¯ãƒªã‚¢ï¼ˆç›´å‰ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ãŒãƒãƒ¼ã‚¯ã®å ´åˆã«å®Ÿè¡Œï¼‰
        if (mark_state_previous.heading || mark_state_previous.bold || mark_state_previous.strikethrough || mark_state_previous.code) {

            //ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒœãƒ¼ãƒ«ãƒ‰ã¨å–æ¶ˆã—ç·šã®ãƒãƒ¼ã‚¯ã®ã‚¯ãƒªã‚¢ï¼ˆç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ãŒãƒãƒ¼ã‚¯ç„¡ã—ã®å ´åˆã«å®Ÿè¡Œï¼‰
            if ((((!mark_state.heading) && (!mark_state.bold) && (!mark_state.strikethrough) && (!mark_state.code)) || (cur_pos.line != cur_pos_previous.line)) && (native_cm_mark_state_previous == "active-line")) {
                try {
                    easyMDE.codemirror.findMarksAt({ line: cur_pos_previous.line, ch: cur_pos_previous.ch })[0].clear();
                } catch (er) {
                    //æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼æ™‚ã«ä¸€æ—¦ãƒãƒ¼ã‚¯çŠ¶æ…‹ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆã—ã¦ç·¨é›†ã‚’ç¶™ç¶šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
                    console.log(er.message);
                    let all_marks = easyMDE.codemirror.getAllMarks();
                    for (let i = 0; i < all_marks.length; i++) {
                        all_marks[i].clear();
                    }

                }
            }

            //ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¯ã®ã‚¯ãƒªã‚¢
            //if (((!mark_state.heading) || (cur_pos.line != cur_pos_previous.line)) && (flg_active_line == true)) {
            //    easyMDE.codemirror.findMarksAt({ line: cur_pos_previous.line, ch: cur_pos_previous.ch })[0].clear();
            //    flg_active_line = !flg_active_line;
            //}
        }



        //ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ã‚¯è¿½åŠ 
        //easyMDE.codemirror.markText({ line: 0, ch: 0 }, { line: 1, ch: 0 }, { className: "hhhhasdf" });

        //ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ã‚¯ã‚¯ãƒªã‚¢
        //easyMDE.codemirror.findMarksAt({ line: easyMDE.codemirror.getCursor().line, ch: easyMDE.codemirror.getCursor().line })[0].clear();


    });
    //ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆä¸­--------------------------------------------------------------------->




</script>

<!-- darkmode.js ï¼ˆé©ç”¨ã®ãŸã‚ã«cssã§è‰²ã€…ä¿®æ­£æ¸ˆã¿ï¼‰-->
<script src="js/darkmode.js"></script>
<script>
    function addDarkmodeWidget() {
        const options = {
            bottom: '4px', // default: '32px'
            right: 'unset', // default: '32px'
            left: '5px', // default: 'unset'
            time: '0s', // default: '0.3s' cssã§noneã«è¨­å®šä¸­
            mixColor: '#fff', // default: '#fff'
            backgroundColor: '#fff',  // default: '#fff'
            buttonColorDark: '#fff',  // default: '#100f2c'
            buttonColorLight: '#100f2c', // default: '#fff'
            saveInCookies: true, // default: true,
            label: 'ğŸŒ“', // default: ''
            autoMatchOsTheme: false // default: true
        }
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
    }
    addDarkmodeWidget();
    //window.addEventListener('load', addDarkmodeWidget);
</script>

<script src="js/misc.js"></script>

<!-- merge_handle js -->
<script src="js/merge_handle.js"></script>

<!-- mermaid js -->
<script src="js/mermaid.js"></script>
<!--<link rel="stylesheet" href="css/mermaid.css">-->
<!--
        MEMO: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’èª­ã¿è¾¼ã¿æ™‚ã«ã—ãªã„
        ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†ãŸã‚
        -->
<script>
    mermaid.initialize({
        startOnLoad: false,
        "theme": "default",
        //"theme": "neutral",
        flowchart: {
            //useMaxWidth: true
            //htmlLabels: true
        }
    });
</script>


<!-- marp js css -->
<script src="./js/marp/bundle.js"></script>
<!-- marp helper js ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æŠœãå‡ºã—ã¦å›ºå®šåŸ‹ã‚è¾¼ã¿ã—ãŸã‚‚ã®ï¼ˆã‚³ãƒ¼ãƒ‰svgã‚’æ­£å¸¸å‹•ä½œã•ã›ã‚‹ãŸã‚ï¼‰ -->
<script src="./js/marp/helper.js"></script>
<script src="js/marp/marp_handle.js"></script>
<link id="marp_css" rel="stylesheet" href="css/marp.css">
<!-- marp_book js -->
<script src="js/marp/marp_book_handle.js"></script>
<!-- slide_show js css -->
<script src="js/marp/slide_show.js"></script>
<link id="slide_show_css" rel="stylesheet" href="css/slide_show_off.css">
<script>
    // Convert Markdown slide deck into HTML and CSS
    //const marp = new Marp(); //bundleå†…ã«ã‚ã‚‹ã®ã§ä¸è¦
    //const { html, css } = marp.render('# Hello, marp-core!');
    //console.log(html + "\n" + css);
</script>


</html>